openapi: 3.0.3
info:
  title: XParse Pipeline API
  description: |
    æ–‡æ¡£è§£ææµæ°´çº¿æ¥å£ï¼Œæ”¯æŒæ–‡æ¡£è§£æï¼ˆParseï¼‰ã€æ–‡æœ¬åˆ†å—ï¼ˆChunkï¼‰å’Œå‘é‡åŒ–ï¼ˆEmbedï¼‰çš„ç»„åˆå¤„ç†ã€‚
    
    **æµæ°´çº¿è§„åˆ™**
    - parse èŠ‚ç‚¹æ˜¯å¿…éœ€çš„ï¼Œä¸”å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    - chunk å’Œ embed èŠ‚ç‚¹æ˜¯å¯é€‰çš„
    - å¦‚æœåŒæ—¶ä½¿ç”¨ chunk å’Œ embedï¼Œchunk å¿…é¡»åœ¨ embed ä¹‹å‰
    - æ¯ç§ç±»å‹çš„èŠ‚ç‚¹æœ€å¤šåªèƒ½å‡ºç°ä¸€æ¬¡
    - stages æ•°ç»„é•¿åº¦å¿…é¡»åœ¨ 1-3 ä¹‹é—´
  version: 1.0.0
  contact:
    name: TextIn API Team

servers:
  - url: https://api.textin.com
    description: ç”Ÿäº§ç¯å¢ƒ

security:
  - AppIdAuth: []
    SecretCodeAuth: []

paths:
  /api/xparse/pipeline:
    post:
      summary: æ–‡æ¡£å¤„ç†æµæ°´çº¿
      description: |
        æ‰§è¡Œæ–‡æ¡£å¤„ç†æµæ°´çº¿ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ parseã€chunkã€embed ä¸‰ç§å¤„ç†é˜¶æ®µã€‚
        
        **æµæ°´çº¿è§„åˆ™**
          - parse èŠ‚ç‚¹æ˜¯å¿…éœ€çš„ï¼Œä¸”å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
          - chunk å’Œ embed èŠ‚ç‚¹æ˜¯å¯é€‰çš„
          - å¦‚æœåŒæ—¶ä½¿ç”¨ chunk å’Œ embedï¼Œchunk å¿…é¡»åœ¨ embed ä¹‹å‰
          - æ¯ç§ç±»å‹çš„èŠ‚ç‚¹æœ€å¤šåªèƒ½å‡ºç°ä¸€æ¬¡
          - stages æ•°ç»„é•¿åº¦å¿…é¡»åœ¨ 1-3 ä¹‹é—´
      operationId: executePipeline
      tags:
        - XParse Pipeline
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - stages
              properties:
                file:
                  type: string
                  format: binary
                  description: éœ€è¦å¤„ç†çš„æ–‡æ¡£æ–‡ä»¶ï¼ˆæ”¯æŒ PDFã€å›¾ç‰‡ç­‰æ ¼å¼ï¼‰
                stages:
                  type: string
                  description: |
                    æµæ°´çº¿é…ç½®çš„ JSON å­—ç¬¦ä¸²ï¼Œå¿…é¡»æ˜¯ PipelineStage æ•°ç»„ã€‚
                    æ³¨æ„ï¼šè™½ç„¶è¿™é‡Œæ˜¯ string ç±»å‹ï¼ˆå› ä¸º form-data é™åˆ¶ï¼‰ï¼Œä½†å†…å®¹å¿…é¡»æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„å­—ç¬¦ä¸²ã€‚

                    **Stages è¯´æ˜ï¼š**

                    Pipeline æ¥å£ä½¿ç”¨ stages æ•°ç»„æ¥å®šä¹‰å¤„ç†æµç¨‹ï¼Œæ¯ä¸ª stage åŒ…å«ï¼š
                    - `type`: é˜¶æ®µç±»å‹ï¼Œå¯é€‰å€¼ï¼š`parse`ã€`chunk`ã€`embed`
                    - `config`: è¯¥é˜¶æ®µçš„é…ç½®ï¼Œå…·ä½“å­—æ®µå–å†³äºé˜¶æ®µç±»å‹

                    **ä½¿ç”¨ç¤ºä¾‹**
        
                    ä»…è§£æï¼š
                    ```json
                    [{"type": "parse", "config": {"provider": "textin"}}]
                    ```
                    
                    è§£æ + åˆ†å—ï¼š
                    ```json
                    [
                      {"type": "parse", "config": {"provider": "textin"}},
                      {"type": "chunk", "config": {"strategy": "basic", "max_characters": 1000}}
                    ]
                    ```
                    
                    è§£æ + åˆ†å— + å‘é‡åŒ–ï¼š
                    ```json
                    [
                      {"type": "parse", "config": {"provider": "textin"}},
                      {"type": "chunk", "config": {"strategy": "by_title", "max_characters": 500}},
                      {"type": "embed", "config": {"provider": "qwen", "model_name": "text-embedding-v4"}}
                    ]
                    ```

                    **å„é˜¶æ®µé…ç½®è¯¦ç»†è¯´æ˜ï¼š**

                    1. **Parse Stage** (`type: "parse"`)

                    Parse å‚æ•°ä¸­æœ‰å¿…å¡«é¡¹`Provider`ï¼Œè¡¨ç¤ºæ–‡æ¡£è§£ææœåŠ¡çš„ä¾›åº”å•†ï¼Œç›®å‰å¯é€‰é¡¹å¦‚ä¸‹ï¼š
                    - textin: åˆåˆä¿¡æ¯æä¾›çš„æ–‡æ¡£è§£ææœåŠ¡ï¼Œåœ¨é€Ÿåº¦ã€å‡†ç¡®æ€§ä¸Šå‡ä¸ºè¡Œä¸šé¢†å…ˆ
                      - æ”¯æŒçš„æ–‡æ¡£è§£æå‚æ•°å‚è€ƒ [Parse å‚æ•°è¯´æ˜](/pipeline/parse#å‚æ•°è¯´æ˜)
                      - æ¥å£è°ƒç”¨å°†æŒ‰ç…§ `TextIn é€šç”¨æ–‡æ¡£è§£æ` æœåŠ¡çš„è®¡è´¹æ ‡å‡†è¿›è¡Œè®¡è´¹
                    - mineru: åŸºäºå¼€æºçš„æœ€æ–°[MinerU](https://github.com/opendatalab/MinerU)è§£æå¼•æ“
                    - paddle: åŸºäºå¼€æºçš„æœ€æ–°[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)è§£æå¼•æ“

                    2. **Chunk Stage** (`type: "chunk"`)

                    - **strategy** (`string`/å¿…å¡«): åˆ†å—ç­–ç•¥ï¼Œé»˜è®¤å€¼ï¼š`basic`
                      - `basic`: åŸºç¡€åˆ†å—ï¼ŒæŒ‰å­—ç¬¦æ•°åˆ†å‰²
                      - `by_title`: æŒ‰æ ‡é¢˜åˆ†å—ï¼Œä¿æŒç« èŠ‚å®Œæ•´æ€§
                      - `by_page`: æŒ‰é¡µé¢åˆ†å—ï¼Œä¿æŒé¡µé¢å®Œæ•´æ€§
                    - **combine_text_under_n_chars** (`int`/å¯é€‰): å°†åŒä¸€éƒ¨åˆ†ä¸­çš„å…ƒç´ åˆå¹¶æˆä¸€ä¸ªæ•°æ®å—ï¼Œç›´åˆ°è¯¥éƒ¨åˆ†çš„æ€»é•¿åº¦è¾¾åˆ°æŒ‡å®šå­—ç¬¦æ•°ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚å¯ç”¨äºå°†è¿‡çŸ­çš„å°å—åˆå¹¶æˆè¾ƒé•¿æ–‡æœ¬ï¼Œæé«˜è¯­ä¹‰è¿è´¯æ€§ã€‚
                    - **include_orig_elements** (`bool`/å¯é€‰): å¦‚æœä¸º `true`ï¼Œç”¨äºæ„æˆæ•°æ®å—çš„åŸå§‹å…ƒç´ ä¼šå‡ºç°åœ¨è¯¥æ•°æ®å—çš„ `.metadata.orig_elements` ä¸­ã€‚é»˜è®¤å€¼ï¼š`False`ã€‚ç”¨äºè°ƒè¯•æˆ–éœ€è¦ä¿ç•™åŸå§‹å…ƒç´ è¿½æº¯çš„åœºæ™¯ã€‚
                    - **new_after_n_chars** (`int`/å¯é€‰): å½“æ–‡æœ¬é•¿åº¦è¾¾åˆ°æŒ‡å®šå­—ç¬¦æ•°æ—¶ï¼Œå¼ºåˆ¶ç»“æŸå½“å‰ç« èŠ‚å¹¶å¼€å§‹æ–°çš„ç« èŠ‚ï¼ˆè¿‘ä¼¼é™åˆ¶ï¼‰ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚é€‚ç”¨äºéœ€è¦æ§åˆ¶ç« èŠ‚æœ€å¤§é•¿åº¦çš„æƒ…å†µä¸‹ã€‚
                    - **max_characters** (`int`/å¯é€‰): æ•°æ®å—ä¸­å…è®¸çš„æœ€å¤§å­—ç¬¦æ•°ä¸Šé™ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚ç”¨äºç¡¬æ€§é™åˆ¶å—å¤§å°ï¼Œé¿å…è¿‡å¤§å—å¸¦æ¥çš„å¤„ç†å»¶è¿Ÿæˆ–å†…å­˜å ç”¨ã€‚
                    - **overlap** (`int`/å¯é€‰): å°†å‰ä¸€ä¸ªæ–‡æœ¬åˆ†å—æœ«å°¾æŒ‡å®šæ•°é‡çš„å­—ç¬¦ï¼Œä½œä¸ºå‰ç¼€åº”ç”¨åˆ°ç”±è¿‡å¤§å…ƒç´ åˆ†å‰²è€Œæˆçš„ç¬¬äºŒä¸ªåŠåç»­æ–‡æœ¬å—ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚å¸¸ç”¨äºç¡®ä¿åˆ†å—ä¹‹é—´çš„ä¸Šä¸‹æ–‡è¿ç»­æ€§ã€‚
                    - **overlap_all** (`bool`/å¯é€‰): å¦‚æœä¸º `true`ï¼Œé‡å ä¹Ÿä¼šåº”ç”¨åˆ°ç”±å®Œæ•´å…ƒç´ ç»„åˆè€Œæˆçš„"æ™®é€š"å—ã€‚é»˜è®¤å€¼ï¼š`False`ã€‚è°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½åœ¨è¯­ä¹‰ä¸Šå¼•å…¥å™ªå£°ã€‚


                    3. **Embed Stage** (`type: "embed"`)

                    `xparse-client`å½“å‰æ”¯æŒçš„æ–‡æœ¬å‘é‡åŒ–æ¨¡å‹å¦‚ä¸‹ï¼š
                    - `qwen` ä¾›åº”å•†ï¼Œå³é€šä¹‰åƒé—®:
                      - `text-embedding-v3`
                      - `text-embedding-v4`
                    - `doubao` ä¾›åº”å•†ï¼Œå³ç«å±±å¼•æ“:
                      - `doubao-embedding-large-text-250515`
                      - `doubao-embedding-text-240715`
                  example: '[{"type":"parse","config":{"provider":"textin"}}]'
            encoding:
              stages:
                contentType: application/json
      responses:
        '200':
          description: å¤„ç†æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PipelineResponse'
              examples:
                parseOnly:
                  summary: ä»…è§£æç¤ºä¾‹
                  value:
                    elements:
                      - element_id: "13a9939f23e485ca20a16c741658bcf64efd82309a6f0a8cf35679a65b2fd0dc"
                        type: "NarrativeText"
                        metadata:
                          filename: "example.pdf"
                          filetype: "application/pdf"
                          file_size: 102400
                          languages: ["zh"]
                          is_continuation: false
                        text: "è¿™æ˜¯è§£æå‡ºçš„æ–‡æœ¬å†…å®¹"
                    stats:
                      original_elements: 10
                      chunked_elements: 0
                      embedded_elements: 0
                      stages:
                        - type: "parse"
                          config: {"provider": "textin"}
                
                fullPipeline:
                  summary: å®Œæ•´æµæ°´çº¿ç¤ºä¾‹
                  value:
                    elements:
                      - element_id: "5f84a1db7c9f4ad65f84a1db7c9f4ad65f84a1db7c9f4ad65f84a1db7c9f4ad6"
                        type: "CompositeElement"
                        metadata:
                          filename: "example.pdf"
                          filetype: "application/pdf"
                          file_size: 102400
                          orig_elements:
                            - "abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789"
                            - "1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                          detection_class_prob: 0.95
                        text: "è¿™æ˜¯å¤„ç†åçš„æ–‡æœ¬å—"
                        embeddings: [0.1, 0.2, 0.3, 0.4]
                    stats:
                      original_elements: 10
                      chunked_elements: 15
                      embedded_elements: 15
                      stages:
                        - type: "parse"
                          config: {"provider": "textin"}
                        - type: "chunk"
                          config:
                            strategy: "basic"
                            max_characters: 1000
                        - type: "embed"
                          config:
                            provider: "qwen"
                            model_name: "text-embedding-v4"
        
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingFile:
                  summary: ç¼ºå°‘æ–‡ä»¶
                  value:
                    code: 400
                    message: "file is required"
                
                invalidStages:
                  summary: stages æ ¼å¼é”™è¯¯
                  value:
                    code: 400
                    message: "parse stages failed: invalid JSON"
                
                stagesValidationError:
                  summary: stages éªŒè¯å¤±è´¥
                  value:
                    code: 400
                    message: "first stage must be parse, got: chunk"
        
        '401':
          description: é‰´æƒå¤±è´¥
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                message: "unauthorized: invalid app-id or secret-code"
        
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                message: "internal server error: parse failed"

components:
  securitySchemes:
      AppIdAuth:
        type: apiKey
        in: header
        name: x-ti-app-id
        description: 'è¯·[ç™»å½•Textin](https://www.textin.com/console/dashboard/setting)åå‰å¾€ "å·¥ä½œå°-è´¦å·è®¾ç½®-å¼€å‘è€…ä¿¡æ¯" æŸ¥çœ‹ x-ti-app-id'
      SecretCodeAuth:
        type: apiKey
        in: header
        name: x-ti-secret-code
        description: 'è¯·[ç™»å½•Textin](https://www.textin.com/console/dashboard/setting)åå‰å¾€ "å·¥ä½œå°-è´¦å·è®¾ç½®-å¼€å‘è€…ä¿¡æ¯" æŸ¥çœ‹ x-ti-secret-code'


  schemas:
    PipelineResponse:
      type: object
      required:
        - elements
        - stats
      properties:
        elements:
          type: array
          description: å¤„ç†åçš„å…ƒç´ åˆ—è¡¨
          items:
            $ref: '#/components/schemas/Element'
        stats:
          $ref: '#/components/schemas/PipelineStats'
    
    Element:
      type: object
      required:
        - element_id
        - type
        - metadata
        - text
      properties:
        element_id:
          type: string
          description: å…ƒç´ å”¯ä¸€æ ‡è¯†ç¬¦
          example: "elem_001"
        type:
          type: string
          description: å…ƒç´ ç±»å‹ï¼ˆå¦‚ Title, NarrativeText, Table ç­‰ï¼‰
          example: "Title"
        metadata:
          $ref: '#/components/schemas/Metadata'
        text:
          type: string
          description: å…ƒç´ çš„æ–‡æœ¬å†…å®¹
          example: "è¿™æ˜¯æ–‡æ¡£ä¸­çš„ä¸€æ®µæ–‡æœ¬"
        embeddings:
          type: array
          description: å‘é‡åŒ–åçš„åµŒå…¥å‘é‡ï¼ˆä»…åœ¨æ‰§è¡Œ embed stage åå­˜åœ¨ï¼‰
          items:
            type: number
            format: float
          example: [0.1, 0.2, 0.3, 0.4, 0.5]
    
    Metadata:
      type: object
      required:
        - filename
      properties:
        record_id:
          type: string
          description: è®°å½• ID
          example: "record_001"
        parent_id:
          type: string
          description: çˆ¶å…ƒç´  ID
          example: "parent_001"
        filename:
          type: string
          description: æ–‡ä»¶å
          example: "example.pdf"
        filetype:
          type: string
          description: æ–‡ä»¶ç±»å‹
          example: "application/pdf"
        file_size:
          type: integer
          format: int64
          description: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
          example: 102400
        file_directory:
          type: string
          description: æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æˆ–å‰ç¼€
          example: "/projects/demo/"
        last_modified:
          type: string
          format: date-time
          description: æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
          example: "2024-11-19T14:15:22Z"
        coordinates:
          type: array
          description: |
            å…ƒç´ åœ¨é¡µé¢ä¸Šçš„åæ ‡ã€‚ä»¥é•¿åº¦ä¸º 8 çš„æ•´å‹æ•°ç»„è¡¨ç¤ºå››è¾¹å½¢ï¼Œ8 ä¸ªæ•°ä¸¤ä¸¤ä¸€ç»„ä¸ºä¸€ä¸ªç‚¹çš„æ¨ªçºµåæ ‡ï¼Œåˆ†åˆ«æ˜¯å·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹ã€‚
            å½“è¾“å…¥æ˜¯ PDF æ—¶ï¼Œæ­¤åæ ‡æ˜¯åŸºäº 72dpi çš„ï¼›å½“è¾“å…¥æ˜¯å›¾ç‰‡æ—¶ï¼Œæ­¤åæ ‡æ˜¯åŸå›¾é‡Œçš„åæ ‡ã€‚å•ä½ï¼šåƒç´ ã€‚
          items:
            type: integer
          minItems: 8
          maxItems: 8
          example: [217, 390, 1336, 390, 1336, 460, 217, 460]
        category_depth:
          type: integer
          description: å…ƒç´ åœ¨åŒç±»å…ƒç´ ä¸­çš„ç›®å½•æ·±åº¦
          example: 1
        languages:
          type: array
          description: å…ƒç´ çš„è¯­è¨€åˆ—è¡¨
          items:
            type: string
          example: ["zh", "en"]
        text_as_html:
          type: string
          description: è¡¨æ ¼æˆ–å¯Œæ–‡æœ¬çš„ HTML è¡¨ç¤º
          example: "<table>...</table>"
        image_base64:
          type: string
          description: å›¾ç‰‡çš„ base64 ç¼–ç 
        image_mine_type:
          type: string
          description: å›¾ç‰‡çš„ MIME ç±»å‹
          example: "image/png"
        emphasized_text_contents:
          type: array
          description: è¢«å¼ºè°ƒï¼ˆç²—ä½“/æ–œä½“ï¼‰çš„æ–‡æœ¬å†…å®¹
          items:
            type: string
        emphasized_text_tags:
          type: array
          description: ä¸å¼ºè°ƒæ–‡æœ¬å¯¹åº”çš„æ ·å¼æ ‡ç­¾
          items:
            type: string
        is_continuation:
          type: boolean
          description: æ˜¯å¦ä¸ä¸‹ä¸€æ®µè½è¿ç»­ï¼ˆä»… parse é˜¶æ®µï¼‰
        orig_elements:
          type: array
          description: åŸå§‹å…ƒç´  ID åˆ—è¡¨ï¼ˆä»…åœ¨ chunk æ—¶è®¾ç½® include_orig_elements ä¸º true æ—¶å­˜åœ¨ï¼‰
          items:
            type: string
          example:
            - "7d3d8091c9f646cf8edcb9bf92f797b1"
            - "bb9d1d24cfb442dcb25bbaaf634e210d"
        detection_class_prob:
          type: number
          format: float
          description: ç‰ˆé¢æ£€æµ‹ç½®ä¿¡åº¦
          example: 0.95
    
    PipelineStats:
      type: object
      required:
        - original_elements
        - chunked_elements
        - embedded_elements
        - stages
      properties:
        original_elements:
          type: integer
          description: åŸå§‹è§£æçš„å…ƒç´ æ•°é‡ï¼ˆparse stage äº§ç”Ÿï¼‰
          example: 10
        chunked_elements:
          type: integer
          description: åˆ†å—åçš„å…ƒç´ æ•°é‡ï¼ˆchunk stage äº§ç”Ÿï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œåˆ™ä¸º 0ï¼‰
          example: 15
        embedded_elements:
          type: integer
          description: å‘é‡åŒ–åçš„å…ƒç´ æ•°é‡ï¼ˆembed stage äº§ç”Ÿï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œåˆ™ä¸º 0ï¼‰
          example: 15
        stages:
          type: array
          description: å®é™…æ‰§è¡Œçš„ stages é…ç½®
          items:
            $ref: '#/components/schemas/PipelineStage'
    
    PipelineStage:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: [parse, chunk, embed]
          description: |
            å¤„ç†é˜¶æ®µç±»å‹ï¼š
            - parse: æ–‡æ¡£è§£æ
            - chunk: æ–‡æœ¬åˆ†å—
            - embed: å‘é‡åŒ–
          example: "parse"
        config:
          type: object
          description: |
            é˜¶æ®µé…ç½®ï¼Œæ ¹æ® type ä¸åŒæœ‰ä¸åŒçš„ç»“æ„ï¼š
            - type=parse: ParseConfig
            - type=chunk: ChunkConfig
            - type=embed: EmbedConfig
          oneOf:
            - $ref: '#/components/schemas/ParseConfig'
            - $ref: '#/components/schemas/ChunkConfig'
            - $ref: '#/components/schemas/EmbedConfig'
          example: {}
    
    ParseConfig:
      type: object
      required:
        - provider
      description: |
        æ–‡æ¡£è§£æé…ç½®ã€‚æ”¯æŒ PDFã€å›¾ç‰‡ç­‰å¤šç§æ–‡æ¡£æ ¼å¼çš„è§£æã€‚
        
        **æ”¯æŒçš„ Parser è§£æå¼•æ“ï¼š**
        - textin: TextIn è‡ªç ”è§£æå¼•æ“
        - mineru: MinerU è§£æå¼•æ“
        - paddle: PaddleOCR è§£æå¼•æ“
      properties:
        provider:
          type: string
          enum: [textin, mineru, paddle]
          description: |
            Parser è§£æå¼•æ“ï¼š
            - textin: TextIn è‡ªç ”è§£æå¼•æ“
            - mineru: MinerU è§£æå¼•æ“
            - paddle: PaddleOCR è§£æå¼•æ“
          default: "textin"
          example: "textin"
        
        pdf_pwd:
          type: string
          description: |
            PDF å¯†ç ã€‚å½“ PDF ä¸ºåŠ å¯†æ–‡æ¡£æ—¶ï¼Œéœ€è¦æä¾›å¯†ç ã€‚
            
            **å®‰å…¨æç¤º**ï¼šå¯¹å‰ç«¯å°è£…è¯¥æ¥å£å‚æ•°æ—¶ï¼Œéœ€è¦è‡ªè¡Œå¯¹å¯†ç è¿›è¡Œå®‰å…¨é˜²æŠ¤ã€‚
          example: "password123"
        
        page_start:
          type: integer
          minimum: 1
          description: |
            èµ·å§‹é¡µç ã€‚å½“ä¸Šä¼ çš„æ˜¯ PDF æ—¶ï¼Œè¡¨ç¤ºä»ç¬¬å‡ é¡µå¼€å§‹è§£æã€‚
            å–å€¼èŒƒå›´ä» 1 å¼€å§‹ï¼Œä¸ä¼ è¯¥å‚æ•°æ—¶é»˜è®¤ä»é¦–é¡µå¼€å§‹ã€‚
          default: 1
          example: 1
        
        page_count:
          type: integer
          minimum: 1
          maximum: 1000
          description: |
            è§£æé¡µæ•°ã€‚å½“ä¸Šä¼ çš„æ˜¯ PDF æ—¶ï¼Œè¡¨ç¤ºè¦è¿›è¡Œè§£æçš„ PDF é¡µæ•°ã€‚
            æ€»é¡µæ•°ä¸å¾—è¶…è¿‡ 1000 é¡µã€‚
          default: 1000
          example: 10
        
        parse_mode:
          type: string
          enum: [auto, scan]
          description: |
            PDF æ–‡æ¡£çš„è§£ææ¨¡å¼ã€‚å›¾ç‰‡ä¸ç”¨è®¾ç½®ï¼Œå‡é»˜è®¤æŒ‰ scan æ¨¡å¼å¤„ç†ã€‚
            
            - **auto**: ç»¼åˆæ–‡å­—è¯†åˆ«å’Œè§£ææ¨¡å¼ï¼Œå¯¹ PDF ç”µå­æ¡£è§£æä¼šç›´æ¥æå– PDF ä¸­çš„æ–‡å­—
            - **scan**: ä»…æŒ‰æ–‡å­—è¯†åˆ«æ¨¡å¼ï¼Œå°† PDF å½“æˆå›¾ç‰‡å¤„ç†
          default: "scan"
          example: "scan"
        
        dpi:
          type: integer
          enum: [72, 144, 216]
          description: |
            PDF æ–‡æ¡£çš„åæ ‡åŸºå‡†ï¼Œä¸ parse_mode å‚æ•°è”åŠ¨ï¼š
            
            - å½“ parse_mode=auto æ—¶ï¼šé»˜è®¤åŠ¨æ€ï¼Œæ”¯æŒ 72ã€144ã€216
            - å½“ parse_mode=scan æ—¶ï¼šé»˜è®¤ 144ï¼Œæ”¯æŒ 72ã€144ã€216
          default: 144
          example: 144
        
        apply_document_tree:
          type: integer
          enum: [0, 1]
          description: |
            Markdown ä¸­æ˜¯å¦ç”Ÿæˆæ ‡é¢˜å±‚çº§ã€‚
            
            - **0**: ä¸ç”Ÿæˆæ ‡é¢˜ï¼ˆåŒæ—¶ä¹Ÿä¸ä¼šè¿”å› catalog å­—æ®µï¼‰
            - **1**: ç”Ÿæˆæ ‡é¢˜
          default: 1
          example: 1
        
        table_flavor:
          type: string
          enum: [md, html, none]
          description: |
            Markdown é‡Œçš„è¡¨æ ¼æ ¼å¼ã€‚
            
            - **md**: æŒ‰ Markdown è¯­æ³•è¾“å‡ºè¡¨æ ¼
            - **html**: æŒ‰ HTML è¯­æ³•è¾“å‡ºè¡¨æ ¼
            - **none**: ä¸è¿›è¡Œè¡¨æ ¼è¯†åˆ«ï¼ŒæŠŠè¡¨æ ¼å›¾åƒå½“æˆæ™®é€šæ–‡å­—æ®µè½æ¥è¯†åˆ«
          default: "html"
          example: "html"
        
        get_image:
          type: string
          enum: [none, page, objects, both]
          description: |
            è·å– Markdown é‡Œçš„å›¾ç‰‡ã€‚
            
            - **none**: ä¸è¿”å›ä»»ä½•å›¾åƒ
            - **page**: è¿”å›æ¯ä¸€é¡µçš„æ•´é¡µå›¾åƒï¼ˆå³ PDF é¡µçš„å®Œæ•´é¡µå›¾ç‰‡ï¼‰
            - **objects**: è¿”å›é¡µé¢å†…çš„å­å›¾åƒï¼ˆå³ PDF é¡µå†…çš„å„ä¸ªå­å›¾ç‰‡ï¼‰
            - **both**: è¿”å›æ•´é¡µå›¾åƒå’Œå›¾åƒå¯¹è±¡
          default: "none"
          example: "none"
        
        image_output_type:
          type: string
          enum: [base64str, default]
          description: |
            æŒ‡å®šè¿”å›çš„å›¾ç‰‡å¯¹è±¡è¾“å‡ºç±»å‹ã€‚
            
            - **base64str**: æŒ‡å®šæ‰€æœ‰å›¾ç‰‡å¯¹è±¡ä¸º base64 å­—ç¬¦ä¸²ï¼Œé€‚ç”¨äºæ²¡æœ‰äº‘å­˜å‚¨çš„ç”¨æˆ·ï¼Œä½†æ˜¯å¼•æ“è¿”å›ç»“æœä½“ç§¯ä¼šå¾ˆå¤§
            - **default**: æŒ‡å®šå­å›¾ç‰‡å¯¹è±¡ä¸ºå›¾ç‰‡ URLï¼Œé¡µå›¾ç‰‡å¯¹è±¡ä¸ºå›¾ç‰‡ ID
          default: "default"
          example: "default"
        
        apply_image_analysis:
          type: integer
          enum: [0, 1]
          description: |
            å›¾åƒåˆ†æå‚æ•°ã€‚åˆ©ç”¨å¤§æ¨¡å‹å¯¹æ–‡æ¡£ä¸­çš„å­å›¾ç‰‡è¿›è¡Œåˆ†æï¼Œåˆ†æç»“æœä»¥ Markdown æ ¼å¼è¾“å‡ºï¼Œ
            å¹¶æ›¿æ¢æ‰å­å›¾ç‰‡çš„æ–‡æœ¬è¯†åˆ«å†…å®¹ã€‚
            
            - **0**: ä¸è¿›è¡Œå›¾åƒåˆ†æ
            - **1**: è¿›è¡Œå›¾åƒåˆ†æ
          default: 0
          example: 0
        
        paratext_mode:
          type: string
          enum: [none, annotation, body]
          description: |
            Markdown ä¸­éæ­£æ–‡æ–‡æœ¬å†…å®¹å±•ç¤ºæ¨¡å¼ã€‚éæ­£æ–‡å†…å®¹åŒ…æ‹¬é¡µçœ‰é¡µè„šã€å­å›¾ä¸­çš„æ–‡æœ¬ã€‚
            
            - **none**: ä¸å±•ç¤º
            - **annotation**: ä»¥æ³¨é‡Šæ ¼å¼æ’å…¥åˆ° Markdown ä¸­ï¼ˆé¡µçœ‰é¡µè„šä¸­çš„å›¾ç‰‡åªä¿ç•™æ–‡æœ¬ï¼Œå›¾ç‰‡ base64 æˆ– URL ä¸ä¿ç•™ï¼‰
            - **body**: ä»¥æ­£æ–‡æ ¼å¼æ’å…¥åˆ° Markdown ä¸­
          default: "annotation"
          example: "annotation"
        
        formula_level:
          type: integer
          enum: [0, 1, 2]
          description: |
            å…¬å¼è¯†åˆ«ç­‰çº§ã€‚å¼€å¯å…¬å¼è¯†åˆ«åï¼Œä¼šä½¿ç”¨ LaTeX è¡¨è¾¾å¼ã€‚
            
            - **0**: è¡Œé—´å…¬å¼å’Œè¡Œå†…å…¬å¼éƒ½è¯†åˆ«
            - **1**: ä»…è¯†åˆ«è¡Œé—´å…¬å¼ï¼Œè¡Œå†…å…¬å¼ä¸è¯†åˆ«
            - **2**: ä¸è¯†åˆ«å…¬å¼
          default: 0
          example: 0
        
        underline_level:
          type: integer
          enum: [0, 1, 2]
          description: |
            æ§åˆ¶ä¸‹åˆ’çº¿è¯†åˆ«èŒƒå›´ã€‚
            
            - **0**: ä¸è¯†åˆ«
            - **1**: ä»…è¯†åˆ«æ— æ–‡å­—çš„ä¸‹åˆ’çº¿ï¼ˆä»… scan æ¨¡å¼å¯ç”¨ï¼‰
            - **2**: è¯†åˆ«å…¨éƒ¨çš„ä¸‹åˆ’çº¿ï¼ˆä»… scan æ¨¡å¼å¯ç”¨ï¼‰
          default: 0
          example: 0
        
        apply_merge:
          type: integer
          enum: [0, 1]
          description: |
            æ˜¯å¦è¿›è¡Œæ®µè½åˆå¹¶å’Œè¡¨æ ¼åˆå¹¶ã€‚
            
            - **0**: ä¸åˆå¹¶
            - **1**: åˆå¹¶æ®µè½å’Œè¡¨æ ¼
          default: 1
          example: 1
        
        raw_ocr:
          type: integer
          enum: [0, 1]
          description: |
            æ˜¯å¦è¿”å›å…¨éƒ¨æ–‡å­—è¯†åˆ«ç»“æœï¼ˆåŒ…å«å­—ç¬¦åæ ‡ä¿¡æ¯ï¼‰ï¼Œç»“æœå­—æ®µä¸º raw_ocrã€‚
            ä¸ page_details å‚æ•°è”åŠ¨ï¼Œå½“ page_details ä¸º 0 æ—¶ä¸è¿”å›ã€‚
            
            - **0**: ä¸è¿”å›
            - **1**: è¿”å›
          default: 0
          example: 0
        
        char_details:
          type: integer
          enum: [0, 1]
          description: |
            æ˜¯å¦è¿”å›ç»“æœä¸­çš„ char_pos å­—æ®µï¼ˆä¿å­˜æ¯ä¸ªå­—ç¬¦çš„ä½ç½®ä¿¡æ¯ï¼‰å’Œ raw_ocr ä¸­çš„ char_ ç›¸å…³å­—æ®µã€‚
            
            - **0**: ä¸è¿”å›
            - **1**: è¿”å›
          default: 0
          example: 0
        
        catalog_details:
          type: integer
          enum: [0, 1]
          description: |
            æ˜¯å¦è¿”å›ç»“æœä¸­çš„ catalog å­—æ®µï¼Œä¿å­˜ç›®å½•ç›¸å…³ä¿¡æ¯ã€‚
            ä¸ apply_document_tree å‚æ•°è”åŠ¨ï¼Œå½“ apply_document_tree ä¸º 0 æ—¶ä¸è¿”å›ã€‚
            
            - **0**: ä¸è¿”å›
            - **1**: è¿”å›
          default: 0
          example: 0
        
        get_excel:
          type: integer
          enum: [0, 1]
          description: |
            æ˜¯å¦è¿”å› Excel çš„ base64 ç»“æœï¼Œç»“æœå­—æ®µä¸º excel_base64ã€‚
            å¯ä»¥æ ¹æ®è¯¥å­—æ®µè¿›è¡Œåå¤„ç†ä¿å­˜ Excel æ–‡ä»¶ã€‚
            
            - **0**: ä¸è¿”å›
            - **1**: è¿”å›
          default: 0
          example: 0
        
        crop_dewarp:
          type: integer
          enum: [0, 1]
          description: |
            åˆ‡è¾¹çŸ«æ­£ã€‚æ˜¯å¦è¿›è¡Œåˆ‡è¾¹çŸ«æ­£é¢„å¤„ç†ã€‚
            
            - **0**: ä¸è¿›è¡Œåˆ‡è¾¹çŸ«æ­£
            - **1**: è¿›è¡Œåˆ‡è¾¹çŸ«æ­£
          default: 0
          example: 0
        
        remove_watermark:
          type: integer
          enum: [0, 1]
          description: |
            å»æ°´å°ã€‚æ˜¯å¦è¿›è¡Œå»æ°´å°é¢„å¤„ç†ã€‚
            
            - **0**: ä¸å»æ°´å°
            - **1**: å»æ°´å°
          default: 0
          example: 0
        
        apply_chart:
          type: integer
          enum: [0, 1]
          description: |
            å›¾è¡¨è¯†åˆ«ã€‚æ˜¯å¦å¼€å¯å›¾è¡¨è¯†åˆ«ï¼Œå¼€å¯å›¾è¡¨è¯†åˆ«ä¼šå°†è¯†åˆ«åˆ°çš„å›¾è¡¨ä»¥è¡¨æ ¼å½¢å¼è¾“å‡ºã€‚
            
            - **0**: ä¸å¼€å¯å›¾è¡¨è¯†åˆ«
            - **1**: å¼€å¯å›¾è¡¨è¯†åˆ«
          default: 0
          example: 0
    
    ChunkConfig:
      type: object
      properties:
        strategy:
          type: string
          enum: [basic, by_title, by_page]
          description: |
            åˆ†å—ç­–ç•¥ï¼š
            - basic: åŸºç¡€åˆ†å—ï¼ˆæŒ‰å­—ç¬¦æ•°åˆ‡åˆ†ï¼‰
            - by_title: æŒ‰æ ‡é¢˜åˆ‡åˆ†
            - by_page: æŒ‰é¡µé¢åˆ‡åˆ†
          default: "basic"
          example: "basic"
        include_orig_elements:
          type: boolean
          description: æ˜¯å¦åœ¨ metadata ä¸­åŒ…å«åŸå§‹å…ƒç´  ID
          default: false
          example: true
        new_after_n_chars:
          type: integer
          description: åœ¨å¤šå°‘å­—ç¬¦ååˆ›å»ºæ–°å—
          example: 800
        max_characters:
          type: integer
          description: æ¯ä¸ªå—çš„æœ€å¤§å­—ç¬¦æ•°
          default: 1000
          example: 1000
        overlap:
          type: integer
          description: ç›¸é‚»å—ä¹‹é—´çš„é‡å å­—ç¬¦æ•°
          example: 100
    
    EmbedConfig:
      type: object
      required:
        - provider
        - model_name
      properties:
        provider:
          type: string
          enum: [qwen, doubao]
          description: |
            Embedding ä¾›åº”å•†ï¼š
            - qwen: é˜¿é‡Œäº‘é€šä¹‰åƒé—®
            - doubao: å­—èŠ‚è·³åŠ¨è±†åŒ…
          default: "qwen"
          example: "qwen"
        model_name:
          type: string
          description: |
            æ¨¡å‹åç§°ï¼Œå¿…é¡»ä¸ provider åŒ¹é…ï¼š
            
            **Qwen æ”¯æŒçš„æ¨¡å‹ï¼š**
            - text-embedding-v3
            - text-embedding-v4
            
            **Doubao æ”¯æŒçš„æ¨¡å‹ï¼š**
            - doubao-embedding-large-text-250515
            - doubao-embedding-text-240715
          default: "text-embedding-v4"
          example: "text-embedding-v4"
          enum:
            - text-embedding-v3
            - text-embedding-v4
            - doubao-embedding-large-text-250515
            - doubao-embedding-text-240715
    
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          description: é”™è¯¯ç 
          example: 400
        message:
          type: string
          description: é”™è¯¯ä¿¡æ¯
          example: "invalid request parameters"

tags:
  - name: XParse Pipeline
    description: |
      æ–‡æ¡£å¤„ç†æµæ°´çº¿æ¥å£
      
      ## åŠŸèƒ½ç‰¹æ€§
      - ğŸ”„ çµæ´»çš„æµæ°´çº¿é…ç½®ï¼šå¯è‡ªç”±ç»„åˆ parseã€chunkã€embed ä¸‰ç§å¤„ç†é˜¶æ®µ
      - ğŸ“„ å¤šæ ¼å¼æ”¯æŒï¼šæ”¯æŒ PDFã€å›¾ç‰‡ç­‰å¤šç§æ–‡æ¡£æ ¼å¼
      - ğŸ§© æ™ºèƒ½åˆ†å—ï¼šæ”¯æŒåŸºç¡€ã€æŒ‰æ ‡é¢˜ã€æŒ‰é¡µé¢ä¸‰ç§åˆ†å—ç­–ç•¥
      - ğŸ¤– å¤šæ¨¡å‹æ”¯æŒï¼šæ”¯æŒé€šä¹‰åƒé—®å’Œè±†åŒ…çš„å¤šç§ embedding æ¨¡å‹
      - ğŸ“Š å¤„ç†ç»Ÿè®¡ï¼šè¿”å›è¯¦ç»†çš„å¤„ç†ç»Ÿè®¡ä¿¡æ¯
      
      ## è®¡è´¹è¯´æ˜
      - æŒ‰ç…§ parse é˜¶æ®µå¤„ç†çš„é¡µæ•°è®¡è´¹
      - chunk å’Œ embed é˜¶æ®µä¸é¢å¤–æ”¶è´¹
      - è®¡è´¹ä¿¡æ¯é€šè¿‡ x-ti-app-id å’Œ x-ti-secret-code è¿›è¡Œå…³è”

