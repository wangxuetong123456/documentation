---
title: "数据源 - Sources"
description: "了解 xParse Pipeline 支持的数据源连接器，包括 S3 兼容服务、本地文件夹和 FTP 远程文件服务"
---

## 概念

数据源连接器（Sources）用于从不同存储系统中读取文档文件。xParse Pipeline 支持多种数据源类型，包括 S3 兼容的对象存储服务、本地文件系统和 FTP 远程文件服务。

通过配置不同的数据源连接器，您可以灵活地从各种存储系统中读取文档，无需修改处理逻辑。

## 支持的数据源

xParse Pipeline 目前支持以下数据源类型：

- **S3 兼容服务**：支持 AWS S3 以及兼容 S3 协议的对象存储服务（如阿里云 OSS、腾讯云 COS、火山引擎、华为云 OBS 等）
- **本地文件夹**：从本地文件系统读取文档
- **FTP 远程文件服务**：从 FTP 服务器读取文档

## S3 兼容服务

S3 兼容服务使用 AWS S3 SDK 接入，支持所有兼容 S3 协议的对象存储服务。

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `type` | `string` | 是 | 固定为 `"s3"` |
| `endpoint` | `string` | 是 | S3 服务端点 URL |
| `access_key` | `string` | 是 | 访问密钥 ID（Access Key ID） |
| `secret_key` | `string` | 是 | 访问密钥（Secret Access Key） |
| `bucket` | `string` | 是 | 存储桶名称 |
| `prefix` | `string` | 否 | 对象前缀（文件夹路径），默认为空字符串 |
| `region` | `string` | 否 | 区域名称，默认为 `"us-east-1"` |

### 配置示例

```python
'source': {
    'type': 's3',
    'endpoint': 'https://your-s3-endpoint.com',
    'access_key': 'your-access-key-id',
    'secret_key': 'your-secret-access-key',
    'bucket': 'your-bucket-name',
    'prefix': 'documents/',  # 可选，指定文件夹前缀
    'region': 'us-east-1'    # 可选，默认为 us-east-1
}
```

### 如何获取鉴权参数

#### AWS S3

1. 登录 [AWS 控制台](https://console.aws.amazon.com/)
2. 进入 IAM 服务，创建用户或使用现有用户
3. 为用户创建访问密钥（Access Key）：
   - 在用户详情页，选择"安全凭证"标签
   - 点击"创建访问密钥"
   - 保存 `Access Key ID` 和 `Secret Access Key`
4. 确保用户具有对应存储桶的读取权限（如 `s3:GetObject`、`s3:ListBucket`）

**端点 URL 格式**：
- 标准端点：`https://s3.{region}.amazonaws.com`
- 例如：`https://s3.us-east-1.amazonaws.com`

#### 阿里云 OSS

阿里云 OSS 兼容 S3 协议，可以使用 S3 SDK 接入。

1. 登录 [阿里云控制台](https://home.console.aliyun.com/)
2. 进入 OSS 服务，创建存储桶（Bucket）
3. 获取访问密钥：
   - 进入"访问控制 RAM" → "用户" → 创建用户或使用现有用户
   - 为用户创建 AccessKey，获取 `AccessKey ID` 和 `AccessKey Secret`
   - 为用户授予 OSS 读取权限（如 `oss:GetObject`、`oss:ListObjects`）
4. 获取 OSS 端点：
   - 在存储桶概览页查看"Endpoint（地域节点）"
   - 格式：`https://oss-{region}.aliyuncs.com`
   - 例如：`https://oss-cn-hangzhou.aliyuncs.com`

**参考文档**：[阿里云 OSS S3 兼容性说明](https://help.aliyun.com/zh/oss/developer-reference/compatibility-with-amazon-s3)

#### 腾讯云 COS

腾讯云 COS 兼容 S3 协议，可以使用 S3 SDK 接入。

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 进入 COS 服务，创建存储桶
3. 获取访问密钥：
   - 进入"访问管理" → "API 密钥管理"
   - 创建或查看密钥，获取 `SecretId` 和 `SecretKey`
   - 确保密钥具有 COS 读取权限
4. 获取 COS 端点：
   - 在存储桶概览页查看"访问域名"
   - 格式：`https://{bucket}.cos.{region}.myqcloud.com` 或 `https://cos.{region}.myqcloud.com`
   - 例如：`https://cos.ap-beijing.myqcloud.com`

**参考文档**：[腾讯云 COS S3 兼容性说明](https://cloud.tencent.com/document/product/436/37421)

#### 火山引擎（VeCloud）

火山引擎对象存储兼容 S3 协议。

1. 登录 [火山引擎控制台](https://console.volcengine.com/)
2. 进入对象存储（TOS）服务，创建存储桶
3. 获取访问密钥：
   - 进入"访问控制" → "密钥管理"
   - 创建访问密钥，获取 `Access Key ID` 和 `Secret Access Key`
   - 确保密钥具有 TOS 读取权限
4. 获取 TOS 端点：
   - 在存储桶概览页查看"Endpoint"
   - 格式：`https://tos-{region}.volces.com`
   - 例如：`https://tos-cn-beijing.volces.com`

**参考文档**：[火山引擎 TOS S3 兼容性说明](https://www.volcengine.com/docs/6349/147050)

#### 华为云 OBS

华为云 OBS 兼容 S3 协议。

1. 登录 [华为云控制台](https://console.huaweicloud.com/)
2. 进入对象存储服务（OBS），创建存储桶
3. 获取访问密钥：
   - 进入"统一身份认证服务（IAM）" → "用户" → 创建用户或使用现有用户
   - 为用户创建访问密钥，获取 `Access Key ID` 和 `Secret Access Key`
   - 为用户授予 OBS 读取权限（如 `obs:bucket:GetObject`、`obs:bucket:ListBucketContents`）
4. 获取 OBS 端点：
   - 在存储桶概览页查看"Endpoint"
   - 格式：`https://obs.{region}.myhuaweicloud.com`
   - 例如：`https://obs.cn-north-4.myhuaweicloud.com`

**参考文档**：华为云 OBS 支持 S3 协议兼容，具体配置请参考华为云官方文档。

### 使用示例

```python
from xparse_pipeline import create_pipeline_from_config

config = {
    'source': {
        'type': 's3',
        'endpoint': 'https://oss-cn-hangzhou.aliyuncs.com',  # 阿里云 OSS 端点
        'access_key': 'your-access-key-id',
        'secret_key': 'your-secret-access-key',
        'bucket': 'my-documents',
        'prefix': 'pdfs/',  # 只处理 pdfs/ 文件夹下的文件
        'region': 'cn-hangzhou'
    },
    # ... 其他配置
}

pipeline = create_pipeline_from_config(config)
pipeline.run()
```

## 本地文件夹

本地文件夹数据源用于从本地文件系统读取文档。

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `type` | `string` | 是 | 固定为 `"local"` |
| `directory` | `string` | 是 | 本地文件夹路径（绝对路径或相对路径） |
| `pattern` | `string` | 否 | 文件匹配模式，支持通配符，默认为 `"*"` |

### 文件匹配模式

`pattern` 参数支持以下通配符：

- `*`：匹配任意字符（不包括路径分隔符）
- `**`：匹配任意字符（包括路径分隔符）
- `?`：匹配单个字符

**示例**：
- `*.pdf`：匹配当前目录下所有 PDF 文件
- `**/*.pdf`：递归匹配所有子目录下的 PDF 文件
- `**/*.{pdf,docx}`：递归匹配所有 PDF 和 Word 文件
- `documents/*.txt`：匹配 documents 目录下的所有文本文件

### 配置示例

```python
'source': {
    'type': 'local',
    'directory': './documents',           # 相对路径
    'pattern': '**/*.{pdf,docx}'          # 递归匹配所有 PDF 和 Word 文件
}
```

或使用绝对路径：

```python
'source': {
    'type': 'local',
    'directory': '/home/user/documents',  # 绝对路径
    'pattern': '*.pdf'                     # 只匹配 PDF 文件
}
```

### 使用示例

```python
from xparse_pipeline import create_pipeline_from_config

config = {
    'source': {
        'type': 'local',
        'directory': './documents',
        'pattern': '**/*.{pdf,docx,txt}'  # 递归处理所有 PDF、Word 和文本文件
    },
    # ... 其他配置
}

pipeline = create_pipeline_from_config(config)
pipeline.run()
```

## FTP 远程文件服务

FTP 数据源用于从 FTP 服务器读取文档，使用 Python 标准库 `ftplib` 实现。

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `type` | `string` | 是 | 固定为 `"ftp"` |
| `host` | `string` | 是 | FTP 服务器地址（IP 或域名） |
| `port` | `integer` | 是 | FTP 服务器端口，默认为 21 |
| `username` | `string` | 是 | FTP 用户名 |
| `password` | `string` | 是 | FTP 密码 |

### 如何获取鉴权参数

FTP 连接需要以下信息：

1. **FTP 服务器地址**：由 FTP 服务提供商提供，通常是 IP 地址或域名
2. **端口**：FTP 默认端口为 21，FTPS（FTP over SSL）通常使用 990
3. **用户名和密码**：由 FTP 服务管理员提供

**常见 FTP 服务**：
- 自建 FTP 服务器：需要联系服务器管理员获取连接信息
- 云服务商 FTP 服务：在云服务商控制台创建 FTP 用户并获取连接信息
- 企业 FTP 服务器：联系 IT 部门获取访问凭证

### 配置示例

```python
'source': {
    'type': 'ftp',
    'host': 'ftp.example.com',
    'port': 21,
    'username': 'your-username',
    'password': 'your-password'
}
```

### 使用示例

```python
from xparse_pipeline import create_pipeline_from_config

config = {
    'source': {
        'type': 'ftp',
        'host': 'ftp.example.com',
        'port': 21,
        'username': 'myuser',
        'password': 'mypassword'
    },
    # ... 其他配置
}

pipeline = create_pipeline_from_config(config)
pipeline.run()
```

### 注意事项

1. **安全性**：FTP 协议传输密码时未加密，建议在生产环境中使用 FTPS（FTP over SSL）或 SFTP
2. **防火墙**：确保 FTP 服务器的端口（通常是 21）未被防火墙阻止
3. **被动模式**：如果遇到连接问题，可能需要配置 FTP 客户端使用被动模式（PASV）

## 手动创建数据源

除了使用配置方式，您也可以手动创建数据源对象：

```python
from xparse_pipeline import S3Source, LocalSource, FtpSource

# 创建 S3 数据源
s3_source = S3Source(
    endpoint='https://oss-cn-hangzhou.aliyuncs.com',
    access_key='your-access-key',
    secret_key='your-secret-key',
    bucket='my-bucket',
    prefix='documents/',
    region='cn-hangzhou'
)

# 创建本地数据源
local_source = LocalSource(
    directory='./documents',
    pattern='*.pdf'
)

# 创建 FTP 数据源
ftp_source = FtpSource(
    host='ftp.example.com',
    port=21,
    username='myuser',
    password='mypassword'
)
```

## 相关文档

- [目的地连接器](/pipeline/destinations) - 了解如何配置目标存储
- [快速启动](/pipeline/quickstart) - 了解如何使用 Pipeline 处理文档
- [解析模块](/pipeline/parse) - 了解文档解析配置

