---
title: "目的地 - Destinations"
description: "了解 xParse Pipeline 支持的目的地连接器，包括 Milvus/Zilliz 向量数据库和本地文件系统"
---

## 概念

目的地连接器（Destinations）用于将处理后的文档元素存储到不同的目标系统中。xParse Pipeline 支持向量数据库和本地文件系统两种存储方式。

通过配置不同的目的地连接器，您可以将处理后的文档元素和向量数据存储到适合您业务场景的系统中。

## 支持的目的地

xParse Pipeline 目前支持以下目的地类型：

- **Milvus/Zilliz 向量数据库**：将向量化的文档元素存储到 Milvus 或 Zilliz 向量数据库，支持高效的语义检索
- **本地文件系统**：将处理结果保存为 JSON 文件到本地文件系统，便于调试和查看

## Milvus/Zilliz 向量数据库

Milvus 是一个开源的向量数据库，Zilliz 是 Milvus 的云服务版本。两者使用相同的 API，可以无缝切换。

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `type` | `string` | 是 | 固定为 `"milvus"` 或 `"zilliz"` |
| `db_path` | `string` | 是 | 数据库连接地址（本地 Milvus 为文件路径，Zilliz 为云服务地址） |
| `collection_name` | `string` | 是 | 集合（Collection）名称 |
| `dimension` | `integer` | 是 | 向量维度，必须与 embed 模型维度一致（当前为 1024） |
| `api_key` | `string` | 否 | Zilliz Cloud API Key（仅 Zilliz 需要） |
| `token` | `string` | 否 | Zilliz Cloud Token（仅 Zilliz 需要，与 api_key 二选一） |

### 本地 Milvus

本地 Milvus 将数据存储在本地文件中，适合单机部署和开发测试。

#### 配置示例

```python
'destination': {
    'type': 'milvus',
    'db_path': './milvus_pipeline.db',      # 本地数据库文件路径
    'collection_name': 'my_collection',      # 集合名称
    'dimension': 1024                        # 向量维度，必须与 embed 模型一致
}
```

#### 如何获取连接参数

本地 Milvus 无需额外的鉴权参数，只需要：

1. **数据库文件路径**：指定本地文件路径，如果文件不存在会自动创建
2. **集合名称**：自定义集合名称，用于存储文档元素
3. **向量维度**：必须与使用的 embed 模型维度一致（当前 Pipeline 使用的模型均为 1024 维）

### Zilliz Cloud

Zilliz Cloud 是 Milvus 的云服务版本，提供托管的向量数据库服务。

#### 配置示例

```python
'destination': {
    'type': 'zilliz',
    'db_path': 'https://xxxxxxx.serverless.xxxxxxx.cloud.zilliz.com.cn',  # Zilliz Cloud 连接地址
    'collection_name': 'my_collection',      # 集合名称
    'dimension': 1024,                      # 向量维度
    'api_key': 'your-zilliz-api-key'        # Zilliz Cloud API Key
}
```

或使用 token：

```python
'destination': {
    'type': 'zilliz',
    'db_path': 'https://xxxxxxx.serverless.xxxxxxx.cloud.zilliz.com.cn',
    'collection_name': 'my_collection',
    'dimension': 1024,
    'token': 'your-zilliz-token'            # 使用 token 替代 api_key
}
```

#### 如何获取鉴权参数

1. **注册 Zilliz Cloud 账号**：
   - 访问 [Zilliz Cloud 官网](https://zilliz.com/cloud)
   - 注册并登录账号

2. **创建集群**：
   - 在 Zilliz Cloud 控制台创建新的集群
   - 选择合适的地域和规格
   - 等待集群创建完成

3. **获取连接信息**：
   - 在集群详情页查看"连接地址"（Endpoint）
   - 格式：`https://xxxxxxx.serverless.xxxxxxx.cloud.zilliz.com.cn`

4. **获取 API Key**：
   - 进入"API Keys"页面
   - 创建新的 API Key 或使用现有 Key
   - 保存 API Key 值（注意：API Key 只显示一次，请妥善保存）

5. **创建集合**（可选）：
   - Pipeline 会自动创建集合，但您也可以预先在控制台创建
   - 确保集合的向量维度与 embed 模型一致（1024 维）

**参考文档**：[Zilliz Cloud 文档](https://docs.zilliz.com/docs)

### 数据 Schema

Pipeline 会自动创建以下 Schema：

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| `element_id` | VARCHAR(128) | 元素唯一标识符（主键） |
| `embeddings` | FLOAT_VECTOR(1024) | 向量嵌入（1024 维） |
| `text` | VARCHAR(65535) | 元素文本内容 |
| `record_id` | VARCHAR(128) | 记录 ID |
| `metadata` | JSON | 元数据信息（动态字段） |

### 使用示例

#### 本地 Milvus

```python
from xparse_pipeline import create_pipeline_from_config

config = {
    'source': {
        # ... 数据源配置
    },
    'destination': {
        'type': 'milvus',
        'db_path': './milvus_pipeline.db',
        'collection_name': 'documents',
        'dimension': 1024
    },
    # ... 其他配置
}

pipeline = create_pipeline_from_config(config)
pipeline.run()
```

#### Zilliz Cloud

```python
from xparse_pipeline import create_pipeline_from_config

config = {
    'source': {
        # ... 数据源配置
    },
    'destination': {
        'type': 'zilliz',
        'db_path': 'https://xxxxxxx.serverless.xxxxxxx.cloud.zilliz.com.cn',
        'collection_name': 'documents',
        'dimension': 1024,
        'api_key': 'your-zilliz-api-key'
    },
    # ... 其他配置
}

pipeline = create_pipeline_from_config(config)
pipeline.run()
```

### 向量检索示例

存储到 Milvus/Zilliz 后，可以使用向量进行相似度检索：

```python
from pymilvus import MilvusClient

# 连接 Milvus（本地或 Zilliz）
client = MilvusClient(
    uri='./milvus_pipeline.db',  # 本地 Milvus
    # 或
    # uri='https://xxxxxxx.serverless.xxxxxxx.cloud.zilliz.com.cn',  # Zilliz Cloud
    # token='your-api-key'  # Zilliz 需要
)

# 将查询文本向量化（需要调用相同的 embed API）
query_vector = [0.1, 0.2, 0.3, ...]  # 1024 维向量

# 检索相似文档
results = client.search(
    collection_name='documents',
    data=[query_vector],
    limit=5,
    search_params={"metric_type": "COSINE", "params": {"nprobe": 10}},
    output_fields=['text', 'metadata']
)

# 处理结果
for result in results[0]:
    print(f"相似度: {1 - result['distance']:.4f}")
    print(f"文本: {result['entity']['text'][:100]}...")
```

## 本地文件系统

本地文件系统目的地将处理结果保存为 JSON 文件，便于查看和调试。

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `type` | `string` | 是 | 固定为 `"local"` |
| `output_dir` | `string` | 是 | 输出目录路径（绝对路径或相对路径） |

### 输出文件格式

每个处理后的文件会生成一个对应的 JSON 文件，文件名格式为：`{原文件名}_result.json`

JSON 文件包含以下内容：

```json
{
    "file_name": "example.pdf",
    "elements": [
        {
            "element_id": "13a9939f23e485ca20a16c741658bcf64efd82309a6f0a8cf35679a65b2fd0dc",
            "type": "NarrativeText",
            "text": "文档内容...",
            "metadata": {
                "filename": "example.pdf",
                "filetype": "application/pdf",
                ...
            },
            "embeddings": [0.1, 0.2, 0.3, ...]
        }
    ],
    "statistics": {
        "total_elements": 100,
        "chunked_elements": 50,
        "embedded_elements": 50
    }
}
```

### 配置示例

```python
'destination': {
    'type': 'local',
    'output_dir': './output'  # 输出目录
}
```

或使用绝对路径：

```python
'destination': {
    'type': 'local',
    'output_dir': '/home/user/pipeline_output'
}
```

### 使用示例

```python
from xparse_pipeline import create_pipeline_from_config

config = {
    'source': {
        # ... 数据源配置
    },
    'destination': {
        'type': 'local',
        'output_dir': './output'
    },
    # ... 其他配置
}

pipeline = create_pipeline_from_config(config)
pipeline.run()
```

运行后，处理结果会保存到 `./output` 目录下，每个文件对应一个 JSON 结果文件。

## 手动创建目的地

除了使用配置方式，您也可以手动创建目的地对象：

```python
from xparse_pipeline import MilvusDestination, LocalDestination

# 创建 Milvus 目的地
milvus_dest = MilvusDestination(
    db_path='./milvus_pipeline.db',
    collection_name='documents',
    dimension=1024
)

# 创建 Zilliz 目的地
zilliz_dest = MilvusDestination(
    db_path='https://xxxxxxx.serverless.xxxxxxx.cloud.zilliz.com.cn',
    collection_name='documents',
    dimension=1024,
    api_key='your-api-key'
)

# 创建本地文件系统目的地
local_dest = LocalDestination(
    output_dir='./output'
)
```

## 选择合适的目的地

### 何时使用 Milvus/Zilliz

- 需要向量检索功能
- 构建 RAG 应用或知识库系统
- 需要高效的语义搜索能力
- 数据量较大，需要分布式存储

### 何时使用本地文件系统

- 开发测试阶段
- 需要查看和调试处理结果
- 数据量较小
- 不需要向量检索功能

## 相关文档

- [数据源连接器](/pipeline/sources) - 了解如何配置数据源
- [快速启动](/pipeline/quickstart) - 了解如何使用 Pipeline 处理文档
- [向量化模块](/pipeline/embed) - 了解向量化配置

